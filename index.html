<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Vehicle Log</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
       
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
       
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
       
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
       
        h1 {
            color: #333;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
       
        h2 {
            color: #333;
            margin-bottom: 16px;
            font-size: 1.3em;
        }
       
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }
       
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.2s;
        }
       
        button:hover {
            background: #5568d3;
        }
       
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
       
        button.secondary {
            background: #e0e0e0;
            color: #333;
        }
       
        button.secondary:hover {
            background: #d0d0d0;
        }
       
        button.small {
            padding: 8px 16px;
            font-size: 14px;
        }
       
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            margin-top: 8px;
        }
       
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
       
        label {
            font-weight: 600;
            color: #555;
            display: block;
            margin-bottom: 4px;
        }
       
        .form-group {
            margin-bottom: 20px;
        }
       
        .log-entry {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: box-shadow 0.2s;
        }
       
        .log-entry:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
       
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 8px;
        }
       
        .log-vehicle {
            font-weight: bold;
            font-size: 1.2em;
            color: #333;
        }
       
        .log-date {
            color: #666;
            font-size: 0.9em;
            margin-top: 4px;
        }
       
        .log-odometer {
            font-weight: bold;
            color: #667eea;
            font-size: 1.1em;
        }
       
        .log-category {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            margin-top: 4px;
        }
       
        .log-notes {
            color: #555;
            margin-top: 12px;
            padding: 12px;
            background: #f5f5f5;
            border-radius: 6px;
        }
       
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }
       
        .stat-box {
            padding: 16px;
            border-radius: 8px;
            text-align: center;
        }
       
        .stat-box.blue { background: #e3f2fd; }
        .stat-box.green { background: #e8f5e9; }
        .stat-box.purple { background: #f3e5f5; }
        .stat-box.orange { background: #fff3e0; }
       
        .stat-label {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 4px;
        }
       
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }
       
        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
       
        .button-group button {
            flex: 1;
        }
       
        .hidden {
            display: none;
        }
       
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
       
        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 16px;
            opacity: 0.3;
        }
       
        .info-box {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 8px;
            padding: 16px;
            color: #1565c0;
            margin-top: 20px;
        }
       
        .warning-box {
            background: #fff3e0;
            border: 2px solid #ff9800;
            border-radius: 8px;
            padding: 16px;
            color: #e65100;
            margin-bottom: 20px;
        }
       
        .sync-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
        }
       
        .sync-status.synced {
            background: #e8f5e9;
            color: #2e7d32;
        }
       
        .sync-status.syncing {
            background: #fff3e0;
            color: #f57c00;
        }
       
        .sync-status.offline {
            background: #ffebee;
            color: #c62828;
        }
       
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
       
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
       
        .setup-section {
            background: #f5f5f5;
            padding: 16px;
            border-radius: 8px;
            margin-top: 12px;
        }
       
        .code-box {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            margin: 8px 0;
        }
       
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
           
            .card {
                padding: 16px;
            }
           
            h1 {
                font-size: 1.5em;
            }
           
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Setup Instructions -->
        <div id="setupCard" class="card">
            <h2>‚öôÔ∏è Automatic Cloud Sync Setup (5 Minutes)</h2>
            <p style="margin-bottom: 16px;">Set up automatic syncing so your data stays perfectly in sync across all devices!</p>
           
            <div class="setup-section">
                <strong>Step 1: Create a GitHub Gist</strong><br>
                - Go to <a href="https://gist.github.com/" target="_blank">gist.github.com</a> and sign in<br>
                - Create new Gist with filename: <code>vehicle-logs.json</code><br>
                - Content: <div class="code-box">{"logs":[]}</div>
                - Click "Create public gist"<br>
                - Copy the Gist ID from URL (e.g., abc123def456...)<br><br>
                
                <strong>Step 2: Create a GitHub Token (for automatic sync)</strong><br>
                - Go to <a href="https://github.com/settings/tokens/new" target="_blank">github.com/settings/tokens/new</a><br>
                - Note: "Vehicle Log App"<br>
                - Expiration: "No expiration" (or 1 year)<br>
                - Check only: ‚úÖ <strong>gist</strong> (under Select scopes)<br>
                - Click "Generate token" at bottom<br>
                - Copy the token (starts with ghp_...)<br>
                - ‚ö†Ô∏è Save it now - you can't see it again!
            </div>
           
            <div class="form-group" style="margin-top: 16px;">
                <label>Your Gist ID:</label>
                <input type="text" id="gistId" placeholder="e.g., abc123def456...">
            </div>
            
            <div class="form-group">
                <label>Your GitHub Token:</label>
                <input type="password" id="githubToken" placeholder="e.g., ghp_xxxxxxxxxxxxx">
                <small style="color: #666;">This stays private in your browser. Never share it!</small>
            </div>
           
            <button onclick="saveGistId()">‚ú® Enable Automatic Sync</button>
           
            <div style="margin-top: 20px; padding: 12px; background: #fff3e0; border-radius: 6px; font-size: 0.9em;">
                <strong>Alternative:</strong> Skip cloud sync and <button class="small secondary" onclick="useLocalOnly()">Use Local Storage Only</button><br>
                <small>(Data won't sync between devices, but app works immediately)</small>
            </div>
        </div>
       
        <!-- Settings Modal -->
        <div id="settingsCard" class="card hidden">
            <h2>‚öôÔ∏è Settings</h2>
           
            <div class="info-box" style="margin-bottom: 20px;">
                <strong>Current Mode:</strong> <span id="currentMode">Local Storage</span>
            </div>
           
            <div class="form-group">
                <label>Enable Automatic Cloud Sync</label>
                <p style="font-size: 0.9em; color: #666; margin-bottom: 12px;">
                    Automatically sync your logs across all devices via GitHub Gist.
                </p>
                <input type="text" id="settingsGistId" placeholder="Gist ID (e.g., abc123def456...)">
                <input type="password" id="settingsGithubToken" placeholder="GitHub Token (e.g., ghp_xxxxx)" style="margin-top: 8px;">
                <button onclick="switchToCloud()" style="margin-top: 12px;">Enable Automatic Sync</button>
            </div>
           
            <div style="margin-top: 20px; padding: 12px; background: #f5f5f5; border-radius: 6px;">
                <p style="font-size: 0.9em; margin-bottom: 8px;"><strong>How to get these:</strong></p>
                <p style="font-size: 0.85em; color: #666; margin-bottom: 8px;"><strong>Gist ID:</strong></p>
                <ol style="font-size: 0.85em; color: #666; padding-left: 20px; margin-bottom: 12px;">
                    <li>Go to <a href="https://gist.github.com/" target="_blank">gist.github.com</a></li>
                    <li>Create: filename = <code>vehicle-logs.json</code>, content = <code>{"logs":[]}</code></li>
                    <li>Copy the ID from the URL</li>
                </ol>
                <p style="font-size: 0.85em; color: #666; margin-bottom: 8px;"><strong>GitHub Token:</strong></p>
                <ol style="font-size: 0.85em; color: #666; padding-left: 20px;">
                    <li>Go to <a href="https://github.com/settings/tokens/new" target="_blank">github.com/settings/tokens/new</a></li>
                    <li>Note: "Vehicle Log", check ‚úÖ gist, generate token</li>
                    <li>Copy the token (starts with ghp_)</li>
                </ol>
            </div>
           
            <div class="button-group" style="margin-top: 20px;">
                <button class="secondary" onclick="hideSettings()">Close</button>
            </div>
        </div>
       
        <!-- Main App (hidden until setup) -->
        <div id="mainApp" class="hidden">
            <div class="card">
                <div class="header">
                    <div>
                        <h1>üöó Family Vehicle Log</h1>
                        <span id="syncStatus" class="sync-status synced">‚úì Local Mode</span>
                    </div>
                    <div style="display: flex; gap: 12px;">
                        <button id="syncButton" class="secondary small hidden" onclick="manualSync()">üîÑ Sync</button>
                        <button class="secondary small" onclick="showSettings()">‚öôÔ∏è Settings</button>
                        <button id="addButton" onclick="toggleAddForm()">‚ûï Add Log</button>
                    </div>
                </div>
               
                <div class="form-group">
                    <label>Filter by Vehicle</label>
                    <select id="vehicleFilter" onchange="filterLogs()">
                        <option value="all">All Vehicles</option>
                    </select>
                </div>
            </div>
           
            <div id="addForm" class="card hidden">
                <h2>Add New Log Entry</h2>
               
                <div class="form-group">
                    <label>Vehicle Name *</label>
                    <input type="text" id="vehicleName" placeholder="e.g., Honda Civic, Toyota Camry" list="vehicleList">
                    <datalist id="vehicleList"></datalist>
                </div>
               
                <div class="form-group">
                    <label>Current Odometer (km) *</label>
                    <input type="number" id="odometer" placeholder="e.g., 45000">
                </div>
               
                <div class="form-group">
                    <label>Category</label>
                    <select id="category">
                        <option value="maintenance">Maintenance</option>
                        <option value="fuel">Fuel</option>
                        <option value="tires">Tires</option>
                        <option value="repair">Repair</option>
                        <option value="inspection">Inspection</option>
                        <option value="other">Other</option>
                    </select>
                </div>
               
                <div class="form-group">
                    <label>Notes</label>
                    <textarea id="notes" rows="3" placeholder="e.g., Changed oil, Rotated tires, Installed new tires"></textarea>
                </div>
               
                <div class="button-group">
                    <button onclick="saveLog()">Save Log Entry</button>
                    <button class="secondary" onclick="toggleAddForm()">Cancel</button>
                </div>
            </div>
           
            <div id="statsCard" class="card hidden"></div>
           
            <div class="card">
                <h2 id="logsTitle">All Logs</h2>
                <div id="logsList">
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <p style="font-size: 1.2em; margin-bottom: 8px;">No logs yet</p>
                        <p>Click "Add Log" to create your first entry!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let logs = [];
        let currentFilter = 'all';
        let gistId = null;
        let githubToken = null;
        let useCloud = false;
       
        // Check if already configured
        async function init() {
            gistId = localStorage.getItem('vehicleLogGistId');
            githubToken = localStorage.getItem('vehicleLogGithubToken');
            useCloud = localStorage.getItem('vehicleLogUseCloud') === 'true';
           
            if (gistId || !useCloud) {
                document.getElementById('setupCard').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                await loadLogs();
               
                if (useCloud && gistId) {
                    if (githubToken) {
                        updateSyncStatus('synced');
                        document.getElementById('syncStatus').innerHTML = '‚òÅÔ∏è Auto Sync';
                    } else {
                        updateSyncStatus('synced');
                        document.getElementById('syncStatus').innerHTML = '‚òÅÔ∏è Read Only';
                    }
                    document.getElementById('syncButton').classList.remove('hidden');
                }
            }
        }
       
        // Save Gist ID and Token
        window.saveGistId = function() {
            const id = document.getElementById('gistId').value.trim();
            const token = document.getElementById('githubToken').value.trim();
            
            if (!id) {
                alert('Please enter your Gist ID');
                return;
            }
            
            if (!token) {
                alert('Please enter your GitHub Token for automatic syncing');
                return;
            }
            
            localStorage.setItem('vehicleLogGistId', id);
            localStorage.setItem('vehicleLogGithubToken', token);
            localStorage.setItem('vehicleLogUseCloud', 'true');
            gistId = id;
            githubToken = token;
            useCloud = true;
           
            document.getElementById('setupCard').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('syncStatus').innerHTML = '‚òÅÔ∏è Auto Sync';
            document.getElementById('syncButton').classList.remove('hidden');
            loadLogs();
        }
       
        // Use local storage only
        window.useLocalOnly = function() {
            localStorage.setItem('vehicleLogUseCloud', 'false');
            useCloud = false;
           
            document.getElementById('setupCard').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('syncStatus').innerHTML = 'üíæ Local Mode';
            loadLogs();
        }
       
        // Update sync status
        function updateSyncStatus(status) {
            const statusEl = document.getElementById('syncStatus');
            if (status === 'synced') {
                statusEl.className = 'sync-status synced';
                statusEl.innerHTML = useCloud ? '‚òÅÔ∏è Synced' : 'üíæ Saved';
            } else if (status === 'syncing') {
                statusEl.className = 'sync-status syncing';
                statusEl.innerHTML = '‚è≥ Syncing...';
            } else {
                statusEl.className = 'sync-status offline';
                statusEl.innerHTML = '‚ö†Ô∏è Error';
            }
        }
       
        // Load logs
        async function loadLogs() {
            if (useCloud && gistId) {
                await loadFromGist();
            } else {
                const saved = localStorage.getItem('vehicleLogs');
                if (saved) {
                    logs = JSON.parse(saved);
                    updateUI();
                }
            }
        }
       
        // Save logs
        async function saveLogs() {
            localStorage.setItem('vehicleLogs', JSON.stringify(logs));
            
            if (useCloud && gistId) {
                await saveToGist();
            } else {
                updateSyncStatus('synced');
            }
        }
        
        // Load from Gist
        async function loadFromGist() {
            try {
                updateSyncStatus('syncing');
                const response = await fetch(`https://api.github.com/gists/${gistId}`);
                
                if (!response.ok) {
                    throw new Error('Failed to load from Gist');
                }
                
                const gist = await response.json();
                const file = gist.files['vehicle-logs.json'];
                
                if (file && file.content) {
                    const data = JSON.parse(file.content);
                    logs = data.logs || [];
                    localStorage.setItem('vehicleLogs', JSON.stringify(logs));
                    updateUI();
                }
                
                updateSyncStatus('synced');
            } catch (error) {
                console.error('Error loading from Gist:', error);
                updateSyncStatus('offline');
                // Fall back to local storage
                const saved = localStorage.getItem('vehicleLogs');
                if (saved) {
                    logs = JSON.parse(saved);
                    updateUI();
                }
            }
        }
        
        // Save to Gist
        async function saveToGist() {
            if (!githubToken) {
                // No token, skip automatic upload
                updateSyncStatus('synced');
                return;
            }
            
            try {
                updateSyncStatus('syncing');
                
                const data = {
                    logs: logs
                };
                
                const response = await fetch(`https://api.github.com/gists/${gistId}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${githubToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        files: {
                            'vehicle-logs.json': {
                                content: JSON.stringify(data, null, 2)
                            }
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Failed to save to Gist');
                }
                
                updateSyncStatus('synced');
            } catch (error) {
                console.error('Error saving to Gist:', error);
                updateSyncStatus('offline');
                alert('‚ö†Ô∏è Failed to sync to Gist. Check your token and try again.');
            }
        }
       
        // Toggle add form
        window.toggleAddForm = function() {
            const form = document.getElementById('addForm');
            form.classList.toggle('hidden');
           
            if (!form.classList.contains('hidden')) {
                document.getElementById('vehicleName').focus();
            }
        }
       
        // Save a new log
        window.saveLog = function() {
            const vehicle = document.getElementById('vehicleName').value.trim();
            const odometer = parseInt(document.getElementById('odometer').value);
            const category = document.getElementById('category').value;
            const notes = document.getElementById('notes').value.trim();
           
            if (!vehicle) {
                alert('Please enter a vehicle name');
                return;
            }
           
            if (!odometer || odometer <= 0) {
                alert('Please enter a valid odometer reading');
                return;
            }
           
            const now = new Date();
            const log = {
                id: Date.now() + Math.random().toString(36).substr(2, 9),
                vehicle: vehicle,
                odometer: odometer,
                category: category,
                notes: notes,
                date: now.toISOString(),
                displayDate: now.toLocaleDateString(),
                displayTime: now.toLocaleTimeString([], {hour: '2-digit', minute: '2-digit'})
            };
           
            logs.push(log);
            logs.sort((a, b) => new Date(b.date) - new Date(a.date));
            saveLogs();
           
            // Reset form
            document.getElementById('vehicleName').value = vehicle;
            document.getElementById('odometer').value = '';
            document.getElementById('notes').value = '';
            document.getElementById('category').value = 'maintenance';
           
            toggleAddForm();
            updateUI();
        }
       
        // Filter logs
        window.filterLogs = function() {
            currentFilter = document.getElementById('vehicleFilter').value;
            updateUI();
        }
       
        // Get vehicles
        function getVehicles() {
            return [...new Set(logs.map(log => log.vehicle))];
        }
       
        // Get vehicle stats
        function getVehicleStats(vehicle) {
            const vehicleLogs = logs.filter(log => log.vehicle === vehicle);
            if (vehicleLogs.length === 0) return null;
           
            const sorted = [...vehicleLogs].sort((a, b) => a.odometer - b.odometer);
            const totalDistance = sorted[sorted.length - 1].odometer - sorted[0].odometer;
            const latestOdometer = Math.max(...vehicleLogs.map(log => log.odometer));
           
            return {
                totalLogs: vehicleLogs.length,
                latestOdometer: latestOdometer,
                totalDistance: totalDistance,
                firstLog: sorted[0].displayDate,
                lastLog: sorted[sorted.length - 1].displayDate
            };
        }
       
        // Update UI
        function updateUI() {
            updateVehicleFilter();
            updateVehicleDatalist();
            updateStats();
            updateLogsList();
        }
       
        // Update vehicle filter
        function updateVehicleFilter() {
            const filter = document.getElementById('vehicleFilter');
            const vehicles = getVehicles();
            const currentValue = filter.value;
           
            filter.innerHTML = `<option value="all">All Vehicles (${logs.length} logs)</option>`;
            vehicles.forEach(vehicle => {
                const count = logs.filter(log => log.vehicle === vehicle).length;
                filter.innerHTML += `<option value="${vehicle}">${vehicle} (${count} logs)</option>`;
            });
           
            filter.value = currentValue;
        }
       
        // Update datalist
        function updateVehicleDatalist() {
            const datalist = document.getElementById('vehicleList');
            const vehicles = getVehicles();
           
            datalist.innerHTML = '';
            vehicles.forEach(vehicle => {
                datalist.innerHTML += `<option value="${vehicle}">`;
            });
        }
       
        // Update stats
        function updateStats() {
            const statsCard = document.getElementById('statsCard');
           
            if (currentFilter === 'all') {
                statsCard.classList.add('hidden');
                return;
            }
           
            const stats = getVehicleStats(currentFilter);
            if (!stats) {
                statsCard.classList.add('hidden');
                return;
            }
           
            statsCard.classList.remove('hidden');
            statsCard.innerHTML = `
                <h2>${currentFilter} - Statistics</h2>
                <div class="stats">
                    <div class="stat-box blue">
                        <div class="stat-label">Total Logs</div>
                        <div class="stat-value">${stats.totalLogs}</div>
                    </div>
                    <div class="stat-box green">
                        <div class="stat-label">Latest Odometer</div>
                        <div class="stat-value">${stats.latestOdometer.toLocaleString()} km</div>
                    </div>
                    <div class="stat-box purple">
                        <div class="stat-label">Distance Tracked</div>
                        <div class="stat-value">${stats.totalDistance.toLocaleString()} km</div>
                    </div>
                    <div class="stat-box orange">
                        <div class="stat-label">First Log</div>
                        <div class="stat-value" style="font-size: 1.1em;">${stats.firstLog}</div>
                    </div>
                </div>
            `;
        }
       
        // Update logs list
        function updateLogsList() {
            const logsList = document.getElementById('logsList');
            const logsTitle = document.getElementById('logsTitle');
           
            const filteredLogs = currentFilter === 'all'
                ? logs
                : logs.filter(log => log.vehicle === currentFilter);
           
            logsTitle.textContent = currentFilter === 'all' ? 'All Logs' : `${currentFilter} Logs`;
           
            if (filteredLogs.length === 0) {
                logsList.innerHTML = `
                    <div class="empty-state">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                        </svg>
                        <p style="font-size: 1.2em; margin-bottom: 8px;">No logs yet</p>
                        <p>Click "Add Log" to create your first entry!</p>
                    </div>
                `;
                return;
            }
           
            logsList.innerHTML = '';
            filteredLogs.forEach(log => {
                const logDiv = document.createElement('div');
                logDiv.className = 'log-entry';
                logDiv.innerHTML = `
                    <div class="log-header">
                        <div>
                            <div class="log-vehicle">${log.vehicle}</div>
                            <div class="log-date">üìÖ ${log.displayDate} at ${log.displayTime}</div>
                        </div>
                        <div style="text-align: right;">
                            <div class="log-odometer">‚è≤Ô∏è ${log.odometer.toLocaleString()} km</div>
                            <div class="log-category">${log.category}</div>
                        </div>
                    </div>
                    ${log.notes ? `<div class="log-notes">${log.notes}</div>` : ''}
                `;
                logsList.appendChild(logDiv);
            });
        }
       
        // Show settings
        window.showSettings = function() {
            document.getElementById('settingsCard').classList.remove('hidden');
            
            let mode = 'üíæ Local Storage Only';
            if (useCloud && gistId) {
                if (githubToken) {
                    mode = `‚òÅÔ∏è Automatic Sync (Gist ID: ${gistId.substring(0, 8)}...)`;
                } else {
                    mode = `‚òÅÔ∏è Read-Only Mode (Gist ID: ${gistId.substring(0, 8)}...)`;
                }
            }
            document.getElementById('currentMode').textContent = mode;
            
            if (useCloud && gistId && !githubToken) {
                document.getElementById('exportSection').classList.remove('hidden');
                document.getElementById('gistLink').href = `https://gist.github.com/${gistId}`;
            } else {
                document.getElementById('exportSection').classList.add('hidden');
            }
        }
       
        // Hide settings
        window.hideSettings = function() {
            document.getElementById('settingsCard').classList.add('hidden');
        }
       
        // Switch to cloud
        window.switchToCloud = async function() {
            const id = document.getElementById('settingsGistId').value.trim();
            const token = document.getElementById('settingsGithubToken').value.trim();
            
            if (!id) {
                alert('Please enter your Gist ID');
                return;
            }
            
            if (!token) {
                alert('Please enter your GitHub Token for automatic syncing');
                return;
            }
           
            localStorage.setItem('vehicleLogGistId', id);
            localStorage.setItem('vehicleLogGithubToken', token);
            localStorage.setItem('vehicleLogUseCloud', 'true');
            gistId = id;
            githubToken = token;
            useCloud = true;
           
            document.getElementById('syncStatus').innerHTML = '‚òÅÔ∏è Auto Sync';
            document.getElementById('syncButton').classList.remove('hidden');
            hideSettings();
            
            // Load data from Gist
            await loadFromGist();
            alert('‚ú® Automatic sync enabled! Your data will now sync automatically across all devices.');
        }
        
        // Manual sync
        window.manualSync = async function() {
            if (!useCloud || !gistId) {
                alert('Cloud sync is not enabled');
                return;
            }
            
            await loadFromGist();
            alert('Synced! Loaded latest data from GitHub Gist.');
        }
        
        // Copy data for manual Gist upload
        window.copyDataForGist = async function() {
            const data = {
                logs: logs
            };
            const jsonString = JSON.stringify(data, null, 2);
            
            try {
                await navigator.clipboard.writeText(jsonString);
                alert('‚úÖ Data copied to clipboard! Now go to your Gist, click Edit, paste this data, and click Update.');
            } catch (err) {
                // Fallback for browsers that don't support clipboard API
                const textArea = document.createElement('textarea');
                textArea.value = jsonString;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert('‚úÖ Data copied to clipboard! Now go to your Gist, click Edit, paste this data, and click Update.');
            }
        }
       
        // Initialize
        init();
    </script>
</body>
</html> 